<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DrugWars fight simulator</title>
  <link rel="stylesheet" href="https://unpkg.com/primer-css@9.6.0/build/build.css" />
  <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/drugwars"></script>
</head>
<body>

<div id="main" class="p-6" v-cloak>
  <div>
    <h3 class="mb-2">
      DrugWars fight simulator
    </h3>
    <textarea
      v-model="input"
      placeholder="Write a comment"
      class="form-control mb-2 width-full"
    /></textarea>
  </div>
  <div class="mb-4">
    <button @click="handleSubmit" class="btn btn-primary mb-2">
      Submit
    </button>
  </div>
  <div class="mb-4">
    <p v-for="l in log">{{ l }}</p>
  </div>
  <div v-if="result.result" class="mb-4">
    <h4 class="mb-4"><b>Result:</b> {{ result.result }}</h4>
    <div v-for="(army) in ['attacker', 'target']" class="mb-4">
      <h4>{{ army }}</h4>
      <p v-for="unit in result[army].units">
        <b>
          {{ unit.key }}
          <span v-if="unit.dead" class="text-red">
            {{ unit.dead }}
          </span>
          <span v-if="unit.dead">
             /
          </span>
          {{ unit.amount }}
        </b>
      </p>
    </div>
  </div>
</div>

<script type="text/javascript">
window.onload = function() {
  new Vue({
    el: '#main',
    data: {
      input: 'bouncer:10\nknifer:5\nVS\nninja:3',
      error: null,
      log: [],
      result: {}
    },
    methods: {
      handleSubmit: function () {
        const input = this.input.split('VS');
        const attackerUnits = this.toUnits(input[0]);
        const targetUnits = this.toUnits(input[1]);
        const json = {
          attacker: { units: attackerUnits },
          target: { units: targetUnits }
        };
        console.log('JSON', json);

        const fight = new drugwars.Fight(json);
        const result = fight.fight();
        this.result = result;
        console.log('Result', result);

        this.log = fight.getLog();
      },
      toUnits: function (input) {
        const troops = input.split('\n').filter(Boolean);
        return troops.map(troop => {
          const [key, amount] = troop.split(':');
          return { key, amount: parseInt(amount) };
        });
      }
    }
  });
};
</script>

<style type="text/css">
[v-cloak] {
  display: none;
}

#main {
  text-align: left;
  max-width: 600px;
  margin: 0 auto;
}

textarea {
  max-width: 600px;
  height: 160px;
}
</style>

</body>
</html>
